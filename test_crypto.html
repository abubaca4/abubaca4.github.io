<!DOCTYPE html>
<html lang="ru">
<head>
	<title>Проверка хеша</title>
	<meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"
        integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-Piv4xVNRyMGpqkS2by6br4gNJ7DXjqk09RmUpJ8jgGtD7zP9yug3goQfGII0yAns"
        crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js" 
		integrity="sha512-nOQuvD9nKirvxDdvQ9OMqe2dgapbPB7vYAMrzJihw5m+aNcf0dX53m6YxM4LgA9u8e9eg9QX+/+mPu8kCNpV2A==" 
		crossorigin="anonymous"></script>
</head>
	<div class="container-fluid">
		<label for="file_select">Выбор файла</label>
		<input type="file" id="file_select" class="form-control-file mb-2">
		<label for="id_crypto_subtle">SHA-1 через crypto subtle</label>
		<input type="text" name="ecg_id_field" class="form-control" id="id_crypto_subtle">
		<label for="id_crypto_js">SHA-1 через CryptoJs</label>
		<input type="text" name="ecg_id_field" class="form-control" id="id_crypto_js">
		<script>
		function arrayBufferToWordArray(ab) {
			var i8a = new Uint8Array(ab);
			var a = [];
			for (var i = 0; i < i8a.length; i += 4) {
				a.push(i8a[i] << 24 | i8a[i + 1] << 16 | i8a[i + 2] << 8 | i8a[i + 3]);
			}
			return CryptoJS.lib.WordArray.create(a, i8a.length);
		}
		
		async function CryptoJS_Get_Sha1_FromFile(inputFile) {
			var reader = new FileReader();
			reader.onload = (function () {
				return async function (e) {
					const arrayBuffer = e.target.result;
					const hash = CryptoJS.SHA1(arrayBufferToWordArray(arrayBuffer));
					document.getElementById('id_crypto_js').value = hash;
				};
			})();
			//чтение файла
			reader.readAsArrayBuffer(inputFile);
		}
		
		async function getFileHash_crypto(inputFile, hashAlgorithm) {
			var reader = new FileReader();
			//назначение действия после полного чтения файла
			reader.onload = (function () {
				return async function (e) {
					//создание хеша средствами браузера может не поддерживаться в старых браузерах(или если соединение не https)
					let result = await crypto.subtle.digest(hashAlgorithm, e.target.result);
					//преобразование ArrayBuffer к строке
					document.getElementById('id_crypto_subtle').value = Array.prototype.map.call(new Uint8Array(result), x => (('00' + x.toString(16)).slice(-2))).join('');
				};
			})();
			//чтение файла
			reader.readAsArrayBuffer(inputFile);
		}
		
		var fileInput = document.getElementById('file_select');
		
		fileInput.addEventListener("change", async function (evt) {
			await CryptoJS_Get_Sha1_FromFile(inputFile);
			await getFileHash_crypto(inputFile, 'SHA-1');
		});
		</script>
	</div>
</html>